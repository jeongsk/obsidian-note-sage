# Feature Specification: MCP Tools Panel

**Feature Branch**: `002-mcp-tools-panel`
**Created**: 2025-12-27
**Status**: Draft
**Input**: User description: "상단 플러그인 아이콘을 마우스 오버하면 현재 툴팁만 출력됩니다. 클릭 가능하게 변경하고 클릭하면 어떤 도구가 연결되고 활성화 되어 있는지 볼 수 있어야 합니다. 그리고 활성/비활성화도 가능합니다."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - View MCP Server Status Panel (Priority: P1)

사용자가 현재 연결된 MCP 서버의 상태를 빠르게 확인할 수 있어야 합니다. 헤더의 플러그 아이콘을 클릭하면 연결된 모든 MCP 서버의 목록과 각 서버의 연결 상태(연결됨, 대기중, 실패)를 한눈에 볼 수 있는 패널이 표시됩니다.

**Why this priority**: MCP 서버 상태 확인은 이 기능의 핵심 목적이며, 사용자가 어떤 도구가 사용 가능한지 파악하는 데 필수적입니다.

**Independent Test**: 헤더의 MCP 아이콘을 클릭하여 패널이 열리고, 등록된 서버 목록과 상태가 표시되는지 확인

**Acceptance Scenarios**:

1. **Given** MCP 서버가 1개 이상 등록되어 있을 때, **When** 헤더의 MCP 아이콘을 클릭하면, **Then** MCP 서버 목록 패널이 드롭다운 형태로 표시됩니다
2. **Given** 패널이 열려 있을 때, **When** 패널 외부를 클릭하거나 아이콘을 다시 클릭하면, **Then** 패널이 닫힙니다
3. **Given** 여러 MCP 서버가 등록되어 있을 때, **When** 패널을 열면, **Then** 각 서버의 이름, 타입, 연결 상태가 목록으로 표시됩니다

---

### User Story 2 - Toggle MCP Server Activation (Priority: P2)

사용자가 패널에서 직접 개별 MCP 서버를 활성화/비활성화할 수 있어야 합니다. 설정 페이지로 이동하지 않고도 빠르게 특정 서버를 켜거나 끌 수 있습니다.

**Why this priority**: 빠른 서버 토글은 설정 페이지 이동 없이 편리하게 제어할 수 있게 해주는 핵심 편의 기능입니다.

**Independent Test**: 패널에서 특정 서버의 토글을 클릭하여 활성/비활성 상태가 변경되고 즉시 반영되는지 확인

**Acceptance Scenarios**:

1. **Given** 활성화된 MCP 서버가 패널에 표시될 때, **When** 해당 서버의 토글을 끄면, **Then** 서버가 비활성화되고 상태가 즉시 업데이트됩니다
2. **Given** 비활성화된 MCP 서버가 패널에 표시될 때, **When** 해당 서버의 토글을 켜면, **Then** 서버가 활성화되고 연결을 시도합니다
3. **Given** 토글 상태가 변경되었을 때, **When** 플러그인을 재시작하면, **Then** 변경된 상태가 유지되어 있습니다

---

### User Story 3 - View Available Tools per Server (Priority: P3)

사용자가 각 MCP 서버에서 제공하는 도구(tools) 목록을 볼 수 있어야 합니다. 서버를 확장하면 해당 서버가 제공하는 모든 도구의 이름과 설명을 확인할 수 있습니다.

**Why this priority**: 도구 목록 확인은 고급 기능으로, 사용자가 어떤 기능을 사용할 수 있는지 상세히 파악하는 데 도움이 됩니다.

**Independent Test**: 연결된 서버를 확장하여 해당 서버가 제공하는 도구 목록이 표시되는지 확인

**Acceptance Scenarios**:

1. **Given** 연결된 MCP 서버가 패널에 표시될 때, **When** 서버 항목을 확장하면, **Then** 해당 서버가 제공하는 도구 목록이 표시됩니다
2. **Given** 도구 목록이 표시될 때, **When** 각 도구 항목을 보면, **Then** 도구 이름과 간단한 설명이 표시됩니다
3. **Given** 서버가 연결되지 않은 상태일 때, **When** 서버를 확장하려고 하면, **Then** "연결 후 도구 목록을 확인할 수 있습니다" 메시지가 표시됩니다

---

### User Story 4 - Quick Access to Settings (Priority: P4)

사용자가 패널에서 설정 페이지로 빠르게 이동할 수 있어야 합니다. 더 상세한 서버 설정이 필요할 때 한 번의 클릭으로 설정 페이지의 MCP 섹션으로 이동할 수 있습니다.

**Why this priority**: 부가 기능으로, 패널에서 제공하지 않는 상세 설정이 필요한 경우 편의성을 높여줍니다.

**Independent Test**: 패널의 설정 바로가기를 클릭하여 설정 페이지의 MCP 섹션이 열리는지 확인

**Acceptance Scenarios**:

1. **Given** MCP 패널이 열려 있을 때, **When** 설정 아이콘/버튼을 클릭하면, **Then** 플러그인 설정 페이지가 열리고 MCP 설정 섹션으로 스크롤됩니다

---

### Edge Cases

- MCP 서버가 하나도 등록되어 있지 않을 때 패널에 "등록된 서버가 없습니다" 메시지와 설정으로 이동하는 안내 표시
- 패널이 열린 상태에서 외부에서 서버 상태가 변경될 때(예: 연결 실패) 패널 내용이 실시간으로 업데이트됨
- 아이콘 클릭과 동시에 다른 드롭다운이 열려 있으면 기존 드롭다운이 먼저 닫힘
- 모바일/태블릿 환경에서의 터치 인터랙션 지원 (Note: 이 플러그인은 데스크톱 전용)
- 서버 토글 중 설정 저장 에러 발생 시 토글 상태를 롤백하고 토스트 알림으로 에러 메시지 표시

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 헤더의 MCP 아이콘 클릭 시 드롭다운 패널을 표시해야 합니다
- **FR-002**: 패널은 등록된 모든 MCP 서버 목록을 표시해야 합니다
- **FR-003**: 각 서버 항목은 서버 이름, 타입(stdio/sse/http), 연결 상태를 표시해야 합니다
- **FR-004**: 각 서버 항목은 활성화/비활성화 토글 스위치를 포함해야 합니다
- **FR-005**: 토글 상태 변경 시 설정이 즉시 저장되고 반영되어야 합니다
- **FR-006**: 연결된 서버는 서버 항목 클릭 시 확장되어 제공하는 도구 목록을 볼 수 있어야 합니다 (토글 영역 제외)
- **FR-007**: 패널 외부 클릭 또는 아이콘 재클릭 시 패널이 닫혀야 합니다
- **FR-008**: 패널에서 설정 페이지로 이동하는 바로가기를 제공해야 합니다
- **FR-009**: 서버 연결 상태 변경 시 패널 내용이 실시간으로 업데이트되어야 합니다
- **FR-010**: 등록된 서버가 없을 때 적절한 빈 상태 메시지를 표시해야 합니다

### Key Entities

- **MCP Server**: 외부 도구를 제공하는 서버 (이름, 타입, 활성화 상태, 연결 상태)
- **Tool**: MCP 서버가 제공하는 개별 기능 (이름, 설명)
- **Connection Status**: 서버 연결 상태 (connected, pending, failed, needs-auth)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 2번의 클릭 이내로 모든 MCP 서버 상태를 확인할 수 있습니다 (아이콘 클릭 → 패널 확인)
- **SC-002**: 서버 활성화/비활성화 토글 후 1초 이내에 상태가 UI에 반영됩니다
- **SC-003**: 기존 툴팁에서 제공하던 정보는 패널에서도 동일하게 확인 가능합니다
- **SC-004**: 패널 열기/닫기 상호작용이 직관적이며 사용자가 첫 시도에 성공합니다

## Clarifications

### Session 2025-12-27

- Q: 패널에서 서버 항목을 확장하여 도구 목록을 보는 방식 → A: 서버 항목 전체 클릭 시 확장/축소 (토글 영역만 제외)
- Q: 서버 활성화/비활성화 토글 중 에러 발생 시 처리 방식 → A: 토글 롤백 + 토스트 알림으로 에러 메시지 표시

## Assumptions

- 기존 MCP 서버 관리 기능(McpServerManager, McpSettingsUI)이 정상 작동한다고 가정
- Obsidian의 드롭다운/팝오버 UI 패턴을 따름
- 도구 목록 정보는 연결된 MCP 서버에서 제공하는 메타데이터를 활용
- 아이콘은 기존 플러그 아이콘을 유지하며 클릭 가능하도록 변경
